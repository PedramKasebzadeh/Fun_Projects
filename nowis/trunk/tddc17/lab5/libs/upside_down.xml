<level zoom="0.3" multiplayer="true" within_check_count="10" inherits_from="upside_down_base.xml" parent="course_menu.xml" id="start_level" g="3.0" kv="0.0" bg_r="45" bg_g="45" bg_b="45"  >


<abstract_objects>
    <GameTimer id="timer" text="Timer:" visible="true"  
               start_time="0" font_size="17" stop_time="-1" count_down="false" x="20" y="380" />
    <MessageList id="message_list" x="20" y="80" font_size="15" for_player="0" />
    <MessageList id="message_list_2" x="20" y="80" font_size="15" for_player="1" />
    <BooleanVariable id="was_at_cp" value="false" />
    <BooleanVariable id="was_at_cp_2" value="false" />

    <BooleanVariable id="player_1_won" value="false" />
    <BooleanVariable id="player_2_won" value="false" />

    <IntegerVariable id="lap_count" value="0" />
    <IntegerVariable id="lap_count_2" value="0" />
</abstract_objects>





<spring_objects>
<ComposedSpringObject x = "-9.41512952416852" y = "-17.31195954751547" id = "the_car" filename = "rocket_car_1.xml" />
<ComposedSpringObject x = "-9.41512952416852" y = "20.31195954751547" id = "the_car_2" filename = "rocket_car_2.xml" />
</spring_objects>




<behavior>
<events>
      <PositionEvent id="object_at_start"
		     object="the_car" 
	             y_greater_than="-100"
	             y_less_than="170"
	             x_greater_than="-100"
		     x_less_than="400" />
      <PositionEvent id="object_at_cp" 
		     object="the_car" 
	             y_greater_than="300"
	             y_less_than="700"
	             x_greater_than="950"
		     x_less_than="1500" />

      <PositionEvent id="object_2_at_start"
		     object="the_car_2" 
	             y_greater_than="-100"
	             y_less_than="170"
	             x_greater_than="-100"
		     x_less_than="400" />
      <PositionEvent id="object_2_at_cp" 
		     object="the_car_2" 
	             y_greater_than="300"
	             y_less_than="700"
	             x_greater_than="950"
		     x_less_than="1500" />


</events>
<actions>

    <SerialCombinedAction id="start_action" >
      <ShowTextAction  id="null"  x="10"  y="70"  text="Buttons: Z, S, X"  duration="0"  font_size="20"  message_list="message_list"  />
      <ShowTextAction  id="null"  x="10"  y="70"  text="Buttons: Directional"  duration="0"  font_size="20"  message_list="message_list_2"  />
      <ShowTextAction  id="null"  x="10"  y="70"  text="Ready!"  duration="0"  font_size="20"  message_list="message_list"  />
      <ShowTextAction  id="null"  x="10"  y="70"  text="Ready!"  duration="0"  font_size="20"  message_list="message_list_2"  />
      <DelayAction duration="200" />
      <ParallelCombinedAction id="null" >
        <ShowTextAction  id="null"  x="10"  y="70"  text="GO!"  duration="0"  font_size="20"  message_list="message_list"  />
        <ShowTextAction  id="null"  x="10"  y="70"  text="GO!"  duration="0"  font_size="20"  message_list="message_list_2"  />
        <StartTimerAction  id="start_timer"  timer="timer"  />
      </ParallelCombinedAction>
    </SerialCombinedAction>


      <ParallelCombinedAction id="set_was_at_cp" >
        <SetVariableAction variable="was_at_cp" new_value="true" />
      </ParallelCombinedAction>

      <ParallelCombinedAction id="set_was_at_cp_2" >
        <SetVariableAction variable="was_at_cp_2" new_value="true" />
      </ParallelCombinedAction>

      <ConditionalAction id="inc_lap_count" >
        <VariableCondition var="was_at_cp" equals="true" />
        <ParallelCombinedAction>
          <IncreaseVariableAction var="lap_count" inc_value="1" /> 
          <ShowTextAction message_list="message_list"
                          text="Great! Just one more lap..."/>
          <SetVariableAction variable="was_at_cp" new_value="false" />
        </ParallelCombinedAction>
        
      </ConditionalAction>

      <ConditionalAction id="inc_lap_count_2" >
        <VariableCondition var="was_at_cp_2" equals="true" />
        <ParallelCombinedAction>
          <IncreaseVariableAction var="lap_count_2" inc_value="1" /> 
          <ShowTextAction message_list="message_list_2"
                          text="Great! Just one more lap..."/>
          <SetVariableAction variable="was_at_cp_2" new_value="false" />
        </ParallelCombinedAction>
        
      </ConditionalAction>


      <ConditionalAction id="stop_timer_when_finished" >
        <AndCondition>
          <VariableCondition var="player_2_won" equals="false" />
          <VariableCondition var="lap_count" equals="2" />
        </AndCondition>
        <SerialCombinedAction>
          <ParallelCombinedAction>
            <StopTimerAction id="stop_timer" timer="timer" />
            <ShowTextAction message_list="message_list"
                            text="Congratulations, you won the race!!!"/>
            <ShowTextAction message_list="message_list_2"
                            text="Loser!!!"/>
            <SetVariableAction variable="player_1_won" new_value="true" />
          </ParallelCombinedAction>
          <DelayAction duration="800" />
          <SwitchLevelAction level="rocket_cars_upside_down_1.xml" />
        </SerialCombinedAction>
        
      </ConditionalAction>

      <ConditionalAction id="stop_timer_when_finished_2" >
        <AndCondition>
          <VariableCondition var="player_1_won" equals="false" />
          <VariableCondition var="lap_count_2" equals="2" />
        </AndCondition>
        <SerialCombinedAction>
          <ParallelCombinedAction>
            <StopTimerAction id="stop_timer" timer="timer" />
            <ShowTextAction message_list="message_list_2"
                            text="Congratulations, you won the race!!!"/>
            <ShowTextAction message_list="message_list"
                            text="Loser!!!"/>
            <SetVariableAction variable="player_2_won" new_value="true" />
          </ParallelCombinedAction>
          <DelayAction duration="800" />
          <SwitchLevelAction level="rocket_cars_upside_down_1.xml" />
        </SerialCombinedAction>
        
      </ConditionalAction>

</actions>
    <event_action_pair event="object_at_start" 
                       action="start_action" />
    <event_action_pair event="object_at_cp"
                       action="set_was_at_cp" />
    <event_action_pair event="object_at_start" 
                       action="inc_lap_count" />
    <event_action_pair event="object_at_start" 
                       action="stop_timer_when_finished" />

    <event_action_pair event="object_2_at_cp"
                       action="set_was_at_cp_2" />
    <event_action_pair event="object_2_at_start" 
                       action="inc_lap_count_2" />
    <event_action_pair event="object_2_at_start" 
                       action="stop_timer_when_finished_2" />

</behavior>

<center_mass ref="the_car" />
<center_mass_2 ref="the_car_2" />
<key_listener ref="the_car" />
<key_listener ref="the_car_2" />

</level>
